<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Reporting Proposal</title>
<!-- 2014-06-19 Thu 16:34 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Ed Cole" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Reporting Proposal</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Synopsis</a></li>
<li><a href="#sec-2">Some Examples of the DSL</a></li>
<li><a href="#sec-3">A Sample Application</a></li>
<li><a href="#sec-4">Architecture</a></li>
<li><a href="#sec-5">Appendices</a></li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Synopsis</h2>
<div class="outline-text-2" id="text-1">
<p>
I am suggesting a solution to several problems we are facing with deploying our new reports.  Here are some issues that should be resolved by the service.
</p>

<ul class="org-ul">
<li>Defining and collecting parameters for a Jasper Report
</li>
<li>Defining and collecting parameters for a CSV export file
</li>
<li>Re-using parameter definitions between reports
</li>
<li>Simple creation and deployment of CSV generators
</li>
</ul>

<p>
The source code of the reports, parameters, parameter lists, and other objects is completely independent of the environment in which it will be executed.  This means that the same code can be used in a Job Sumbission script or a Grails application, or anything in between.
</p>

<p>
It is also a text-based format, so it will be easy to use version control for them.  The parameter, parameter list, and report definitions would be stored in the file system.  It should be relatively simple to implement an inheritance scheme.
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Some Examples of the DSL</h2>
<div class="outline-text-2" id="text-2">
<p>
Here are some examples from the unit tests that show how you might use the domain specific language.
</p>
</div>
<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Creating a Parameter</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-groovy"><span class="linenr">1: </span><span style="color: #a020f0;">def</span> <span style="color: #a0522d;">p</span> = a.param(name: <span style="color: #8b2252;">'scoobydoo'</span>, <span style="color: #a020f0;">default</span>: <span style="color: #8b2252;">'scared'</span>,
<span class="linenr">2: </span>                value: <span style="color: #8b2252;">'hungry'</span>);
</pre>
</div>
<p>
(From <a href="src\test\groovy\edu\sunyjcc\simple_report\SimpleReportBuilderTest.groovy">SimpleReportBuilderTest.groovy</a>)
</p>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Creating a Parameter List</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">

<pre class="src src-groovy"><span class="linenr">1: </span><span style="color: #a020f0;">def</span> <span style="color: #a0522d;">p</span> = a.params {
<span class="linenr">2: </span>  param(name: <span style="color: #8b2252;">'scoobydoo'</span>, <span style="color: #a020f0;">default</span>: <span style="color: #8b2252;">'scared'</span>)
<span class="linenr">3: </span>  param(name: <span style="color: #8b2252;">'shaggy'</span>, label: <span style="color: #8b2252;">"Shaggy"</span>, <span style="color: #a020f0;">default</span>: <span style="color: #8b2252;">"hungry"</span>)
<span class="linenr">4: </span>}
</pre>
</div>
<p>
(From <a href="src\test\groovy\edu\sunyjcc\simple_report\SimpleReportBuilderTest.groovy">SimpleReportBuilderTest.groovy</a>)
</p>
</div>
</div>
<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Creating a Report with a CSV Data Source</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-groovy"><span class="linenr">1: </span><span style="color: #a020f0;">def</span> <span style="color: #a0522d;">e</span> = a.report() {
<span class="linenr">2: </span>  csv(text: <span style="color: #8b2252;">"A, B, C\n1,2,3"</span>){}
<span class="linenr">3: </span>}
</pre>
</div>
<p>
(From <a href="src\test\groovy\edu\sunyjcc\simple_report\SimpleReportBuilderCsvTest.groovy">SimpleReportBuilderCsvTest.groovy</a>)
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">A Sample Application</h2>
<div class="outline-text-2" id="text-3">
<p>
Suppose that you wanted to have a report of all Grails applications in our system.  You could write a report definition file, <a href="sampleReport.srep">sampleReport.srep</a>.  
</p>

<div class="org-src-container">

<pre class="src src-groovy">report(name: <span style="color: #8b2252;">'Term Report'</span>) {
  param(name: <span style="color: #8b2252;">'app_type_code'</span>, desc: <span style="color: #8b2252;">"Application type code"</span>, <span style="color: #a020f0;">default</span>: <span style="color: #8b2252;">'FORM'</span>) 
  sql(query: <span style="color: #8b2252;">"""</span>
<span style="color: #8b2252;">    select app_sa, app_title</span>
<span style="color: #8b2252;">        from apps a </span>
<span style="color: #8b2252;">        where a.app_type_code = :app_type_code</span>
<span style="color: #8b2252;">        order by app_sa"""</span>)
}
</pre>
</div>

<p>
Run the report by invoking it from a Groovy script that I wrote.
</p>

<div class="org-src-container">

<pre class="src src-cmd">runReport.groovy -u <span style="color: #a0522d;">%userid%</span> -r sampleReport.srep app_<span style="color: #a020f0;">type</span>_code=GRLS
</pre>
</div>
<p>
With the following output.
</p>
<pre class="example">
APP_SA                 APP_TITLE
---------------------- -------------------------------
804                    Add-On Menu Administration
807                    Add-On Menu Administration
823                    Popsel Reference Editor
824                    Key Inventory
4 rows selected.
</pre>
<p>
The <a href="runReport.groovy">runReport.groovy</a> script is just a shell; it has 27 lines that gather the  report parameters and connect to the database, 22 lines that format the report for output, and only 4 lines that actually run the report (counting an assertion that guarantees that it <i>is</i> a report).
(See <i>Downloading the application</i> below to run the example yourself).
</p>

<div class="org-src-container">

<pre class="src src-groovy"><span style="color: #a020f0;">def</span> <span style="color: #a0522d;">b</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">SimpleReportBuilder</span>()
<span style="color: #a020f0;">def</span> r = b.eval(repScript.text).init(sql: sql)
assert r <span style="color: #a020f0;">instanceof</span> SimpleReport
<span style="color: #a020f0;">def</span> p = r.execute(optParams)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Architecture</h2>
<div class="outline-text-2" id="text-4">
<p>
A complete system would contain the following pieces.
</p>

<dl class="org-dl">
<dt> Client        </dt><dd>This might be a web browser or a script that runs in Job Submission.
</dd>
<dt> Front End     </dt><dd>This might be a Grails application; its job is to communicate between the client and the Report Engine.  For example, one job that falls to the front end is converting the list of parameters into an HTML form in a web application.
</dd>
<dt> Report Engine </dt><dd>The report engine fetches the relevant report, parameter list, and parameter definitions from the Report Store, queries the front end for the parameters, and returns the results to the Front End.
</dd>
<dt> Report Store  </dt><dd>This is probably a version-controlled directory or set of directories in the file system, containing the source for parameters, parameter lists, reports, and Jasper Reports jrxml files.
</dd>
</dl>


<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Client</th>
<th scope="col" class="left">Front End</th>
<th scope="col" class="left">Report Engine</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">Request Report &rarr;</td>
<td class="left">&rarr; Request report &rarr;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">Fetch report definition from storage &rarr;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">Get parameter specification</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&larr; Return parameter specification to front end</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&larr; Generate parameter form</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">Return parameters &rarr;</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&rarr; Return parameters to engine &rarr;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">Validate Parameters</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">Get Report Data</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
<td class="left">&larr; Return raw report data to front end</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">&larr; Format report data for client &larr;</td>
<td class="left">&#xa0;</td>
</tr>

<tr>
<td class="left">Display data</td>
<td class="left">&#xa0;</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Appendices</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Downloading the application</h3>
<div class="outline-text-3" id="text-5-1">
<p>
My demonstration is in the java/lib/simple_report repository on the <a href="https://inb01.sunyjcc.edu/git/">GitBlit server</a>.  You can go directly to the summary page here.
</p>

<p>
<a href="https://inb01.sunyjcc.edu/git/summary/java!lib!simple_report.git">https://inb01.sunyjcc.edu/git/summary/java!lib!simple_report.git</a>
</p>

<p>
It's probably better to take the url from the <b>repository url</b> listed on this page, but you can clone it with the following command (the difference is that GitBlit puts your user name in its link).
</p>

<div class="org-src-container">

<pre class="src src-cmd">git clone https://inb01.sunyjcc.edu/git/git/java/lib/simple_report.git
</pre>
</div>

<p>
To build the project, run <code>build.cmd</code> and it should create the jar files and groovydoc for you.  It will download <a href="http://www.gradle.org/">Gradle</a> the first time you run it.
</p>
</div>
</div>
</div>
</div>
</body>
</html>
